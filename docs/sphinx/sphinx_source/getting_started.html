<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting Started &mdash; FFTMatvec 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Documentation" href="docs.html" />
    <link rel="prev" title="Welcome to FFTMatvec’s Documentation!" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            FFTMatvec
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-program">Example Program</a></li>
<li class="toctree-l2"><a class="reference internal" href="#license">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docs.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Comm.html">Comm</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Matrix.html">Matrix</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Vector.html">Vector</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Matvec.html">Matvec</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Utils.html">Utils</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Tester.html">Tester</a><ul class="simple">
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">LICENSE</a><ul class="simple">
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">FFTMatvec</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Getting Started</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/sphinx_source/getting_started.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this heading"></a></h1>
<div class="toctree-wrapper compound">
</div>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading"></a></h2>
<p>To build the code, the following dependencies are required:</p>
<ul class="simple">
<li><p>CUDA (with cuFFT, cuBLAS, and cuTENSOR 2.x) and a CUDA enabled GPU</p></li>
<li><p><a class="reference external" href="https://github.com/NVIDIA/nccl">NCCL</a></p></li>
</ul>
<p>First, clone the repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/s769/FFTMatvec.git
<span class="nb">cd</span><span class="w"> </span>matvec-test
</pre></div>
</div>
<p>Then, build the code:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake<span class="w"> </span>-B<span class="w"> </span>build<span class="w"> </span>-DNCCL_LIBRARIES<span class="o">=</span>/path/to/nccl/lib<span class="w"> </span>-DNCCL_INCLUDE_DIRS<span class="o">=</span>/path/to/nccl/include<span class="w"> </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Release<span class="w"> </span>-DCUTENSOR_ROOT<span class="o">=</span>/path/to/cutensor
cmake<span class="w"> </span>--build<span class="w"> </span>build
</pre></div>
</div>
<p><strong>Note</strong>: the <code class="docutils literal notranslate"><span class="pre">-DCUTENSOR_ROOT</span></code> option is only needed if the cuTENSOR 2.x library is not in the usual CUDA library path.
Some systems may have the cuTENSOR 1.x library in the CUDA library path, which is not compatible with this code.
In that case, the cuTENSOR 2.x library must be <a class="reference external" href="https://developer.nvidia.com/cutensor-downloads">installed</a>, and
the path to the cuTENSOR 2.x library must be provided to the build command.</p>
<p>To build the documentation, the following dependencies are required:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.sphinx-doc.org/en/master/">Sphinx</a> (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">sphinx-rtd-theme</span></code>)</p></li>
<li><p><a class="reference external" href="https://breathe.readthedocs.io/en/latest/">Breathe</a> (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">breathe</span></code>)</p></li>
<li><p><a class="reference external" href="https://www.doxygen.nl/index.html">Doxygen</a></p></li>
</ul>
<p>Then, build the documentation by passing the <code class="docutils literal notranslate"><span class="pre">-DBUILD_DOCS=ON</span></code> flag to the <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-B</span> <span class="pre">build</span> <span class="pre">...</span></code> command.</p>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading"></a></h2>
<p>The main executable is <code class="docutils literal notranslate"><span class="pre">fft_matvec</span></code>. It takes the following arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-pr</span></code> (int): Number of processor rows (default: 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-pc</span></code> (int): Number of processor columns (default: 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-g</span></code> (bool): Use global sizes (default: false)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Nm</span></code> (int): Number of global block columns (default: 10, ignored if
<code class="docutils literal notranslate"><span class="pre">-g</span></code> is false)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Nd</span></code> (int): Number of global block rows (default: 5, ignored if
<code class="docutils literal notranslate"><span class="pre">-g</span></code> is false)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Nt</span></code> (int): Block size (default: 7)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-nm</span></code> (int): Number of local block columns (default: 3, ignored if
<code class="docutils literal notranslate"><span class="pre">-g</span></code> is true)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-nd</span></code> (int): Number of local block rows (default: 2, ignored if
<code class="docutils literal notranslate"><span class="pre">-g</span></code> is true)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-v</span></code> (bool): Print input/output vectors (default: false)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-N</span></code> (int): Number of matvecs to use for timing (default: 100)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-raw</span></code> (bool): Print raw timing data instead of table (default:
false)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-t</span></code> (bool): Check matvec results (default: false)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-h</span></code> (bool): Print help message</p></li>
</ul>
<p><strong>Note</strong>: <code class="docutils literal notranslate"><span class="pre">pr</span> <span class="pre">x</span> <span class="pre">pc</span></code> must be equal to the number of processors used to run the code.
If no values are provided for <code class="docutils literal notranslate"><span class="pre">-pr</span></code> and <code class="docutils literal notranslate"><span class="pre">-pc</span></code>, the code will run with <code class="docutils literal notranslate"><span class="pre">pr</span> <span class="pre">=</span> <span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">pc</span> <span class="pre">=</span> <span class="pre">num_mpi_procs</span></code>.</p>
<p>For boolean arguments, just pass the flag to enable it without a value.
For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpiexec<span class="w"> </span>-np<span class="w"> </span><span class="m">4</span><span class="w"> </span>./build/fft_matvec<span class="w"> </span>-pr<span class="w"> </span><span class="m">2</span><span class="w"> </span>-pc<span class="w"> </span><span class="m">2</span><span class="w"> </span>-g<span class="w"> </span>-Nm<span class="w"> </span><span class="m">20</span><span class="w"> </span>-Nd<span class="w"> </span><span class="m">10</span><span class="w"> </span>-Nt<span class="w"> </span><span class="m">7</span><span class="w"> </span>-nm<span class="w"> </span><span class="m">4</span><span class="w"> </span>-nd<span class="w"> </span><span class="m">3</span><span class="w"> </span>-v<span class="w"> </span>-N<span class="w"> </span><span class="m">100</span>
</pre></div>
</div>
<p>will run the code with 4 processors, a 2x2 processor grid, global sizes,
20 global block columns, 10 global block rows, a block size of 7, 4
local block columns, 3 local block rows, print input/output vectors, and
use 100 matvecs for timing.</p>
<p>To reproduce the results in the paper, run with the configurations
described in the Numerical Results section.</p>
</section>
<section id="example-program">
<h2>Example Program<a class="headerlink" href="#example-program" title="Permalink to this heading"></a></h2>
<p>The following is the main program for the FFTMatvec code (used for testing):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @file main.cpp</span>
<span class="cm"> * @brief This file contains the main function for the matvec-test program.</span>
<span class="cm"> *</span>
<span class="cm"> * The program performs matrix-vector multiplication using MPI parallelization.</span>
<span class="cm"> * It takes command line arguments to configure the matrix and vector dimensions,</span>
<span class="cm"> * the number of processor rows and columns, and other options.</span>
<span class="cm"> *</span>
<span class="cm"> * The main function initializes MPI, parses command line arguments, creates a communication object,</span>
<span class="cm"> * initializes matrices and vectors, performs matrix-vector multiplication, and prints the results.</span>
<span class="cm"> *</span>
<span class="cm"> * @param argc The number of command line arguments.</span>
<span class="cm"> * @param argv An array of command line argument strings.</span>
<span class="cm"> * @return 0 on success, 1 on error.</span>
<span class="cm"> */</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Comm.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Matrix.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Vector.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;cmdparser.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;matvec.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;shared.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;tester.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;utils.hpp&quot;</span>

<span class="c1">// enable/disable timing (see shared.hpp)</span>
<span class="cp">#if TIME_MPI</span>
<span class="cp">#define WARMUP 10</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">warmup</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="cm">/**</span>
<span class="cm"> * @brief Configures the parser.</span>
<span class="cm"> * @param parser The parser.</span>
<span class="cm"> */</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">configureParser</span><span class="p">(</span><span class="n">cli</span><span class="o">::</span><span class="n">Parser</span><span class="o">&amp;</span><span class="w"> </span><span class="n">parser</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">set_optional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pr&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;proc_rows&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Number of processor rows (proc_rows x proc_cols = num_mpi_ranks)&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">set_optional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;proc_cols&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Number of processor columns (proc_rows x proc_cols = num_mpi_ranks)&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">set_optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;g&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;glob_inds&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Use global indices&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">set_optional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Nm&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;glob_cols&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Number of global columns&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">set_optional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Nd&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;glob_rows&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Number of global rows&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">set_optional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Nt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;unpad_size&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Number of time points&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">set_optional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;nm&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;num_cols&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Number of local columns&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">set_optional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;nd&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;num_rows&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Number of local rows&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">set_optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;verbose&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Print vectors&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">set_optional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;reps&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Number of repetitions (for timing purposes)&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">set_optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;raw&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;print_raw&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Print raw times (instead of table)&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">set_optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Run tests&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/********/</span>
<span class="cm">/* MAIN */</span>
<span class="cm">/********/</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">world_rank</span><span class="p">,</span><span class="w"> </span><span class="n">world_size</span><span class="p">,</span><span class="w"> </span><span class="n">provided</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Initialize the MPI environment (OpenMP is used so we need to use MPI_Init_thread)</span>
<span class="w">    </span><span class="n">MPICHECK</span><span class="p">(</span><span class="n">MPI_Init_thread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="n">MPI_THREAD_FUNNELED</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">provided</span><span class="p">));</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">provided</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MPI_THREAD_FUNNELED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world_rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;The provided MPI level is not sufficient</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">MPICHECK</span><span class="p">(</span><span class="n">MPI_Abort</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Parse command line arguments</span>
<span class="w">        </span><span class="n">cli</span><span class="o">::</span><span class="n">Parser</span><span class="w"> </span><span class="n">parser</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">);</span>
<span class="w">        </span><span class="n">configureParser</span><span class="p">(</span><span class="n">parser</span><span class="p">);</span>
<span class="w">        </span><span class="n">parser</span><span class="p">.</span><span class="n">run_and_exit_if_error</span><span class="p">();</span>

<span class="w">        </span><span class="n">MPICHECK</span><span class="p">(</span><span class="n">MPI_Comm_rank</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">world_rank</span><span class="p">));</span>
<span class="w">        </span><span class="n">MPICHECK</span><span class="p">(</span><span class="n">MPI_Comm_size</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">world_size</span><span class="p">));</span>

<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">proc_rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pr&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">proc_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;pc&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Check that the number of processor rows and columns is valid</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world_size</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">proc_rows</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">proc_cols</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">proc_rows</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">proc_cols</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">proc_rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">                </span><span class="n">proc_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">world_size</span><span class="p">;</span>
<span class="w">                </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Warning: Proc Rows x Proc Cols must equal the total number of MPI &quot;</span>
<span class="w">                                </span><span class="s">&quot;ranks. Got %d x %d = %d, expected %d. Using %d x %d = %d instead</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">proc_rows</span><span class="p">,</span><span class="w"> </span><span class="n">proc_cols</span><span class="p">,</span><span class="w"> </span><span class="n">proc_rows</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">proc_cols</span><span class="p">,</span><span class="w"> </span><span class="n">world_size</span><span class="p">,</span><span class="w"> </span><span class="n">proc_rows</span><span class="p">,</span><span class="w"> </span><span class="n">proc_cols</span><span class="p">,</span>
<span class="w">                    </span><span class="n">proc_rows</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">proc_cols</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world_rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;Proc Rows x Proc Cols must equal the total number of MPI ranks. Got %d x %d = &quot;</span>
<span class="w">                    </span><span class="s">&quot;%d, expected %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">proc_rows</span><span class="p">,</span><span class="w"> </span><span class="n">proc_cols</span><span class="p">,</span><span class="w"> </span><span class="n">proc_rows</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">proc_cols</span><span class="p">,</span><span class="w"> </span><span class="n">world_size</span><span class="p">);</span>
<span class="w">                </span><span class="n">MPICHECK</span><span class="p">(</span><span class="n">MPI_Abort</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">row_color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">world_rank</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">proc_rows</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">col_color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">world_rank</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">proc_rows</span><span class="p">;</span>

<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">glob_inds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;g&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">unpad_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Nt&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">glob_num_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Nm&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">glob_num_rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Nd&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">num_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;nm&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">num_rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;nd&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// If not using global indices, calculate the number of global columns and rows</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">glob_inds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">glob_num_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_cols</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">proc_cols</span><span class="p">;</span>
<span class="w">            </span><span class="n">glob_num_rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_rows</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">proc_rows</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// If using global indices, calculate the number of local columns and rows</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">glob_inds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">num_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">col_color</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">glob_num_cols</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">proc_cols</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">glob_num_cols</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">proc_cols</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                                                               </span><span class="o">:</span><span class="w"> </span><span class="n">glob_num_cols</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">proc_cols</span><span class="p">;</span>
<span class="w">            </span><span class="n">num_rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">row_color</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">glob_num_rows</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">proc_rows</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">glob_num_rows</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">proc_rows</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                                                               </span><span class="o">:</span><span class="w"> </span><span class="n">glob_num_rows</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">proc_rows</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Check that the number of local columns and rows is valid when using global indices</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">glob_inds</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">proc_rows</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">glob_num_rows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world_rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;make sure proc_rows &lt;= glob_num_rows </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">MPICHECK</span><span class="p">(</span><span class="n">MPI_Abort</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">glob_inds</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">proc_cols</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">glob_num_cols</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world_rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;make sure proc_cols &lt;= glob_num_cols </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">MPICHECK</span><span class="p">(</span><span class="n">MPI_Abort</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">unpad_size</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world_rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Proc Rows: %d, Proc Cols: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">proc_rows</span><span class="p">,</span><span class="w"> </span><span class="n">proc_cols</span><span class="p">);</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Global Rows: %d, Global Cols: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">glob_num_rows</span><span class="p">,</span><span class="w"> </span><span class="n">glob_num_cols</span><span class="p">);</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Unpad Size: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">unpad_size</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="cp">#if TIME_MPI</span>
<span class="w">        </span><span class="n">MPICHECK</span><span class="p">(</span><span class="n">MPI_Barrier</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">));</span>
<span class="w">        </span><span class="n">t_list</span><span class="p">[</span><span class="n">ProfilerTimesFull</span><span class="o">::</span><span class="n">COMM_INIT</span><span class="p">].</span><span class="n">start</span><span class="p">();</span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="c1">// Create a communicator object</span>
<span class="w">        </span><span class="n">Comm</span><span class="w"> </span><span class="n">comm</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span><span class="w"> </span><span class="n">proc_rows</span><span class="p">,</span><span class="w"> </span><span class="n">proc_cols</span><span class="p">);</span>
<span class="cp">#if TIME_MPI</span>
<span class="w">        </span><span class="n">MPICHECK</span><span class="p">(</span><span class="n">MPI_Barrier</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">));</span>
<span class="w">        </span><span class="n">t_list</span><span class="p">[</span><span class="n">ProfilerTimesFull</span><span class="o">::</span><span class="n">COMM_INIT</span><span class="p">].</span><span class="n">stop</span><span class="p">();</span>
<span class="cp">#endif</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world_rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Created Comm</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="cp">#if TIME_MPI</span>
<span class="w">        </span><span class="n">MPICHECK</span><span class="p">(</span><span class="n">MPI_Barrier</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">));</span>
<span class="w">        </span><span class="n">t_list</span><span class="p">[</span><span class="n">ProfilerTimesFull</span><span class="o">::</span><span class="n">SETUP</span><span class="p">].</span><span class="n">start</span><span class="p">();</span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="c1">// Create matrices and vectors</span>
<span class="w">        </span><span class="n">Matrix</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">num_cols</span><span class="p">,</span><span class="w"> </span><span class="n">num_rows</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world_rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Created Matrices</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">init_mat_ones</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world_rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Initialized Matrices</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">Vector</span><span class="w"> </span><span class="n">in_F</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">num_cols</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;col&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">in_FS</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">num_rows</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;row&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Vector</span><span class="w"> </span><span class="n">out_F</span><span class="p">(</span><span class="n">in_FS</span><span class="p">),</span><span class="w"> </span><span class="n">out_FS</span><span class="p">(</span><span class="n">in_F</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world_rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Created Vectors</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Initialize vectors with ones for testing</span>
<span class="w">        </span><span class="n">in_F</span><span class="p">.</span><span class="n">init_vec_ones</span><span class="p">();</span>
<span class="w">        </span><span class="n">in_FS</span><span class="p">.</span><span class="n">init_vec_ones</span><span class="p">();</span>
<span class="w">        </span><span class="n">out_F</span><span class="p">.</span><span class="n">init_vec</span><span class="p">();</span>
<span class="w">        </span><span class="n">out_FS</span><span class="p">.</span><span class="n">init_vec</span><span class="p">();</span>

<span class="cp">#if TIME_MPI</span>
<span class="w">        </span><span class="n">MPICHECK</span><span class="p">(</span><span class="n">MPI_Barrier</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">));</span>
<span class="w">        </span><span class="n">t_list</span><span class="p">[</span><span class="n">ProfilerTimesFull</span><span class="o">::</span><span class="n">SETUP</span><span class="p">].</span><span class="n">stop</span><span class="p">();</span>
<span class="cp">#endif</span>

<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">print</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">print</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">in_F</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;in_F&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">in_FS</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;in_FS&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world_rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Initialized Vectors</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">reps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">);</span>

<span class="cp">#if !TIME_MPI</span>
<span class="w">        </span><span class="n">reps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="cp">#if TIME_MPI</span>
<span class="w">        </span><span class="n">MPICHECK</span><span class="p">(</span><span class="n">MPI_Barrier</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">));</span>
<span class="w">        </span><span class="n">t_list</span><span class="p">[</span><span class="n">ProfilerTimesFull</span><span class="o">::</span><span class="n">FULL</span><span class="p">].</span><span class="n">start</span><span class="p">();</span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="c1">// Perform matrix-vector multiplication</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">reps</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">WARMUP</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">F</span><span class="p">.</span><span class="n">matvec</span><span class="p">(</span><span class="n">in_F</span><span class="p">,</span><span class="w"> </span><span class="n">out_F</span><span class="p">);</span>
<span class="w">            </span><span class="n">F</span><span class="p">.</span><span class="n">transpose_matvec</span><span class="p">(</span><span class="n">in_FS</span><span class="p">,</span><span class="w"> </span><span class="n">out_FS</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="cp">#if TIME_MPI</span>
<span class="w">        </span><span class="n">MPICHECK</span><span class="p">(</span><span class="n">MPI_Barrier</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">));</span>
<span class="w">        </span><span class="n">t_list</span><span class="p">[</span><span class="n">ProfilerTimesFull</span><span class="o">::</span><span class="n">FULL</span><span class="p">].</span><span class="n">stop</span><span class="p">();</span>
<span class="cp">#endif</span>

<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Run tests</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Tester</span><span class="o">::</span><span class="n">check_ones_matvec</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">out_F</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">            </span><span class="n">Tester</span><span class="o">::</span><span class="n">check_ones_matvec</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">out_FS</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world_rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Finished Matvecs</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">print</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">out_F</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;out_F&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">out_FS</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;out_FS&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="cp">#if !TIME_MPI</span>

<span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">matvec</span><span class="p">(</span><span class="n">in_F</span><span class="p">,</span><span class="w"> </span><span class="n">out_FS</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="w">        </span><span class="n">F</span><span class="p">.</span><span class="n">transpose_matvec</span><span class="p">(</span><span class="n">in_FS</span><span class="p">,</span><span class="w"> </span><span class="n">out_F</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">print</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">out_F</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;out_F&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">out_FS</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;out_FS&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="cp">#endif</span>
<span class="w">        </span><span class="c1">// Print timing results</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">print_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;raw&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world_rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Timing Results Showing Mean, Min, and Max Times Over %d Processor(s) (%d &quot;</span>
<span class="w">                   </span><span class="s">&quot;Matvecs):</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">world_size</span><span class="p">,</span><span class="w"> </span><span class="n">reps</span><span class="p">);</span>

<span class="w">        </span><span class="n">Utils</span><span class="o">::</span><span class="n">print_times</span><span class="p">(</span><span class="n">reps</span><span class="p">,</span><span class="w"> </span><span class="o">!</span><span class="n">print_raw</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">MPICHECK</span><span class="p">(</span><span class="n">MPI_Finalize</span><span class="p">());</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this heading"></a></h2>
<p>This code is released under the MIT License. See <a class="reference external" href="LICENSE.html">LICENSE</a>
for more information.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="Welcome to FFTMatvec’s Documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="docs.html" class="btn btn-neutral float-right" title="API Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Sreeram Venkat, Milinda Fernando, Stefan Henneking, Omar Ghattas.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>